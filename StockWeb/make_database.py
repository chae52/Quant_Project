from functions import *
import os

os.environ.setdefault("DJANGO_SETTINGS_MODULE", "StockWeb.settings")

import django

django.setup()

from home.models import *

stock_list = ['020150_일진머티리얼즈',
              '017670_SK텔레콤',
              '018260_삼성에스디에스',
              '018880_한온시스템',
              '019170_신풍제약',
              '016360_삼성증권',
              '015760_한국전력',
              '012330_현대모비스',
              '011780_금호석유',
              '011170_롯데케미칼',
              '011790_SKC',
              '011200_HMM',
              '009830_한화솔루션',
              '010130_고려아연',
              '010140_삼성중공업',
              '009540_한국조선해양',
              '009150_삼성전기',
              '011070_LG이노텍',
              '008930_한미사이언스',
              '010950_S-Oil',
              '008770_호텔신라',
              '005830_DB손해보험',
              '008560_메리츠증권',
              '007070_GS리테일',
              '006400_삼성SDI',
              '005490_POSCO',
              '006800_미래에셋증권',
              '006360_GS건설',
              '006280_녹십자',
              '005940_NH투자증권',
              '005930_삼성전자',
              '004020_현대제철',
              '003550_LG',
              '003670_포스코케미칼',
              '003490_대한항공',
              '004990_롯데지주',
              '003410_쌍용C&E',
              '002790_아모레G',
              '000810_삼성화재',
              '005380_현대차',
              '000720_현대건설',
              '000660_SK하이닉스',
              '000270_기아',
              '000120_CJ대한통운',
              '000100_유한양행',
              '105560_KB금융',
              '096770_SK이노베이션',
              '097950_CJ제일제당',
              '090430_아모레퍼시픽',
              '086280_현대글로비스',
              '081660_휠라홀딩스',
              '078930_GS',
              '071050_한국금융지주',
              '088980_맥쿼리인프라',
              '068270_셀트리온',
              '066570_LG전자',
              '055550_신한지주',
              '086790_하나금융지주',
              '051910_LG화학',
              '051900_LG생활건강',
              '047810_한국항공우주',
              '047040_대우건설',
              '042660_대우조선해양',
              '036460_한국가스공사',
              '035720_카카오',
              '036570_엔씨소프트',
              '035420_NAVER',
              '035250_강원랜드',
              '034220_LG디스플레이',
              '034730_SK',
              '034020_두산중공업',
              '032640_LG유플러스',
              '029780_삼성카드',
              '030200_KT',
              '028260_삼성물산',
              '028670_팬오션',
              '033780_KT&G',
              '028050_삼성엔지니어링',
              '024110_기업은행',
              '032830_삼성생명',
              '021240_코웨이',
              '207940_삼성바이오로직스',
              '128940_한미약품',
              '139480_이마트',
              '180640_한진칼',
              '241560_두산밥캣']
arr = [['LG', 0.97],
         ['쌍용C&E', -1.23],
         ['대한항공', -1.29],
         ['아모레G', 4.05],
         ['삼성화재', 2.42],
         ['현대건설', -1.06],
         ['SK하이닉스', 2.19],
         ['기아', 0.03],
         ['CJ대한통운', 3.66],
         ['유한양행', -1.69],
         ['현대모비스', -1.43],
         ['금호석유', -2.06],
         ['SKC', -3.19],
         ['HMM', -1.11],
         ['롯데케미칼', 1.67],
         ['LG이노텍', -1.07],
         ['S-Oil', 1.15],
         ['현대미포조선', 0.79],
         ['삼성중공업', -0.54],
         ['고려아연', 0.74],
         ['한화솔루션', -0.72],
         ['한국조선해양', -1.38],
         ['삼성전기', -0.59],
         ['한미사이언스', 4.96],
         ['호텔신라', -0.64],
         ['메리츠증권', -0.91],
         ['GS리테일', -2.5],
         ['미래에셋증권', -0.66],
         ['삼성SDI', -3.9],
         ['녹십자', -0.95],
         ['NH투자증권', -0.67],
         ['GS건설', -2.23],
         ['삼성전자', -5.52],
         ['DB손해보험', 0.97],
         ['POSCO', -3.11],
         ['현대차', -1.11],
         ['롯데지주', 0.69],
         ['현대제철', -1.14],
         ['포스코케미칼', 0.26],
         ['한국전력', -1.91],
         ['SK텔레콤', -4.18],
         ['삼성증권', -0.9],
         ['삼성에스디에스', -2.28],
         ['삼성엔지니어링', -0.55],
         ['LG유플러스', -0.77],
         ['삼성카드', -2.63],
         ['KT', -2.9],
         ['팬오션', -0.25],
         ['일진머티리얼즈', -1.23],
         ['삼성물산', -1.3],
         ['기업은행', 4.02],
         ['신풍제약', -1.37],
         ['한온시스템', 0.75],
         ['코웨이', 4.16],
         ['SK이노베이션', -1.03],
         ['아모레퍼시픽', -0.62],
         ['맥쿼리인프라', -1.02],
         ['현대글로비스', -4.53],
         ['하나금융지주', -2.13],
         ['휠라홀딩스', 2.76],
         ['GS', 0.6],
         ['한국금융지주', -4.61],
         ['셀트리온', 1.73],
         ['LG전자', -4.56],
         ['신한지주', -1.12],
         ['LG화학', -0.64],
         ['LG생활건강', 4.12],
         ['한국항공우주', 1.37],
         ['대우건설', -1.35],
         ['엔씨소프트', -1.87],
         ['대우조선해양', -0.65],
         ['한국가스공사', -1.09],
         ['카카오', 3.23],
         ['NAVER', 0.55],
         ['강원랜드', -0.63],
         ['SK', 1.48],
         ['KT&G', 1.67],
         ['LG디스플레이', 2.75],
         ['두산중공업', -1.61],
         ['삼성생명', -1.69],
         ['한진칼', -1.02],
         ['두산밥캣', -1.49],
         ['삼성바이오로직스', -2.17],
         ['이마트', -0.87],
         ['한미약품', 1.26],
         ['CJ제일제당', -3.03],
         ['KB금융', 0.73]]
arr_dict = {name:value for name,value in arr}

for stock in stock_list:
    print('------------------------------------------------')
    stock_code, stock_name = stock.split('_')
    abnormal_url = 'static/abnormal_data/{}.csv'.format(stock_code)
    abnormal_list = make_abnormal_date(abnormal_url)
    logo_img = make_logo_img(stock_name)
    stock_rate = arr_dict[stock_name]

    if len(logo_img) != 0:
        print(stock_name, stock_code, abnormal_list, logo_img, stock_rate)
        stock_model = StockModel.objects.create(stock_name=stock_name, stock_code=stock_code, stock_logo_img=logo_img,stock_rate=stock_rate)

    for idx, abnormal in enumerate(abnormal_list[-10:]):
        text = make_date(abnormal)
        start_date, end_date = text.split()
        titles = make_wordcloud(stock_name, idx, start_date, end_date)
        wordcloud_by_idx_src = '/wordcloud/{}_{}.jpg'.format(stock_name,idx)
        print(idx, start_date, end_date, titles, wordcloud_by_idx_src)
        Abnormal.objects.create(stock_model=stock_model, idx=idx, abnormal_date=text, related_news_title_url=titles, related_news_wordcloud=wordcloud_by_idx_src)

    print('------------------------------------------------')
